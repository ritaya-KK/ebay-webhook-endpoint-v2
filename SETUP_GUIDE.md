# eBay販売管理・古物台帳システム セットアップガイド

## 前提条件

- Googleアカウント
- eBay Developer Programアカウント
- eBayストアアカウント

## セットアップ手順

### Step 1: Googleスプレッドシートの作成

1. **Google Driveにアクセス**
   - https://drive.google.com にアクセス
   - Googleアカウントでログイン

2. **新しいスプレッドシートを作成**
   - 「新規作成」→「Googleスプレッドシート」を選択
   - スプレッドシートの名前を「eBay販売管理・古物台帳システム」に変更

### Step 2: Google Apps Scriptの設定

1. **Apps Scriptエディタを開く**
   - スプレッドシートで「拡張機能」→「Apps Script」を選択

2. **スクリプトファイルを作成**
   - デフォルトの`Code.gs`を削除
   - 以下の4つのファイルを作成：

#### ファイル1: `create_spreadsheet.gs`
- スプレッドシート作成スクリプト
- 6つのシートと必要な列を設定

#### ファイル2: `ebay_api_integration.gs`
- eBay API連携機能
- 注文データ取得、返金データ取得、利益計算

#### ファイル3: `csv_import_automation.gs`
- CSVインポート・在庫管理機能
- 商品追加、データ検証、自動採番

#### ファイル4: `menu_integration.gs`
- メニュー統合機能
- カスタムメニューの作成

3. **各ファイルにコードをコピー**
   - 提供されたコードを各ファイルにコピー＆ペースト

### Step 3: eBay API設定

1. **eBay Developer Programに登録**
   - https://developer.ebay.com にアクセス
   - eBayアカウントでログイン
   - 開発者アカウントを作成

2. **アプリケーションを作成**
   - 「My Account」→「Application Keys」を選択
   - 「Create a New Key」をクリック
   - アプリケーション名を入力（例：「eBay管理システム」）
   - アプリケーションタイプを「Web Application」に設定

3. **API KeyとSecretを取得**
   - 作成されたアプリケーションの詳細ページで以下を確認：
     - App ID (Client ID)
     - Cert ID (Client Secret)

### Step 4: Webhook (通知エンドポイント) の設定

1. **Apps ScriptをWebアプリとしてデプロイ**
   - Apps Scriptエディタ右上の青い「デプロイ」ボタン > 「新しいデプロイ」を選択します。
   - 「種類の選択」（歯車アイコン）> 「ウェブアプリ」を選択します。
   - **アクセスできるユーザー** を **「全員」** に設定し、「デプロイ」をクリックします。
   - 表示された「ウェブアプリのURL」をコピーしておきます。このURLが通知エンドポイントになります。

2. **eBay Developer Portalで通知設定を行う**
   - Event Notificationのページを開きます。
   - 「Marketplace Account Deletion」を選択します。
   - **Marketplace account deletion notification endpoint**: 先ほどコピーした「ウェブアプリのURL」を貼り付けます。
   - **Verification token**: 以下のトークンをコピーして貼り付けます。
     - `MyUniqueTokenForEbayWebhookByRyuji321GoGo`
   - 「Save」をクリックして設定を保存します。

### Step 4: スプレッドシートの初期化

1. **初期化スクリプトを実行**
   - Apps Scriptエディタで`create_spreadsheet.gs`を開く
   - `main()`関数を選択して実行
   - 初回実行時は認証が必要

2. **必要なシートが作成されることを確認**
   - 在庫管理シート（古物台帳）
   - 販売管理シート（利益計算）
   - 固定費管理シート
   - 外注費管理シート
   - 送料管理シート
   - 設定シート

### Step 5: 基本設定

1. **設定シートで基本設定を入力**
   - eBay API Key: Step 3で取得したApp ID
   - eBay API Secret: Step 3で取得したCert ID
   - 為替レート（USD/JPY）: 現在の為替レート（例：150）
   - 利益率目標: 目標利益率（例：30%）
   - リサーチ利益配分率: 外注スタッフへの配分率（例：5%）
   - 個人仕入れ還付率: 個人仕入れの還付率（8%）
   - 商店仕入れ還付率: 商店仕入れの還付率（10%）
   - eBayストア料金: 月額ストア料金（円）

2. **固定費管理シートに固定費を入力**
   - eBayストア料金
   - その他の固定費

### Step 6: 初期データの入力

1. **在庫管理シートに既存商品を入力**
   - 手動で商品情報を入力
   - または「在庫管理」メニュー→「一括商品追加」を使用

2. **外注費管理シートに外注先を入力**
   - クラウドワークスや個人への外注費
   - 支払い方法や支払い日

### Step 7: 動作確認

1. **メニューの確認**
   - スプレッドシートを再読み込み
   - 上部メニューバーに以下が表示されることを確認：
     - eBay管理
     - 在庫管理
     - システム管理

2. **基本機能のテスト**
   - 「在庫管理」→「新商品追加」でテスト商品を追加
   - 「eBay管理」→「eBay注文データ取得」でAPI接続をテスト
   - 「システム管理」→「システム状態チェック」で設定を確認

## トラブルシューティング

### よくある問題と解決方法

#### 1. Apps Scriptの認証エラー
**問題**: スクリプト実行時に認証エラーが発生
**解決方法**:
- 初回実行時は「詳細」→「安全でないページに移動」を選択
- Googleアカウントでログインして権限を許可

#### 2. eBay API認証エラー
**問題**: eBay APIへの接続でエラーが発生
**解決方法**:
- API KeyとSecretが正しく設定されているか確認
- eBay Developer Programの設定でアプリケーションが有効になっているか確認
- サンドボックス環境とプロダクション環境の設定を確認

#### 3. スプレッドシートが作成されない
**問題**: 初期化スクリプトを実行してもシートが作成されない
**解決方法**:
- Apps Scriptの実行ログを確認
- エラーメッセージに従って修正
- 手動でシートを作成してからスクリプトを実行

#### 4. メニューが表示されない
**問題**: カスタムメニューが表示されない
**解決方法**:
- スプレッドシートを再読み込み
- Apps Scriptで`onOpen()`関数を手動実行
- ブラウザのキャッシュをクリア

#### 5. データが正しく計算されない
**問題**: 利益計算や還付計算が正しくない
**解決方法**:
- 設定シートの為替レートを確認
- 仕入れ先区分と還付率の設定を確認
- 「在庫管理」→「データ検証」を実行

## セキュリティに関する注意事項

### 1. API Keyの管理
- API KeyとSecretは安全に管理
- 第三者に共有しない
- 定期的に更新することを推奨

### 2. データのバックアップ
- 重要なデータは定期的にバックアップ
- 「システム管理」→「データバックアップ」を活用
- Google Driveのバージョン履歴を活用

### 3. アクセス権限
- スプレッドシートの共有設定を適切に管理
- 必要最小限の権限のみを付与

## 運用開始後のメンテナンス

### 1. 定期メンテナンス
- 月次でデータ検証を実行
- 為替レートを定期的に更新
- システム状態チェックを実行

### 2. データ更新
- 新しい商品は「在庫管理」→「新商品追加」で追加
- eBayデータは「eBay管理」→「eBay注文データ取得」で更新
- 送料データは「在庫管理」→「送料CSVインポート」で更新

### 3. レポート確認
- 月次レポートは「eBay管理」→「月次レポート生成」で確認
- 利益率や還付率の傾向を分析
- 必要に応じて設定値を調整

## サポート

システムに関する質問や問題がございましたら、以下の方法でサポートを受けることができます：

1. **ヘルプ機能**
   - 「システム管理」→「ヘルプ」で基本的な使用方法を確認

2. **クイックスタートガイド**
   - 「システム管理」→「クイックスタートガイド」で初期設定を確認

3. **システム状態チェック**
   - 「システム管理」→「システム状態チェック」で設定状況を確認

4. **開発者サポート**
   - 技術的な問題は開発者までお問い合わせください

## 更新履歴

- v1.0.0: 初回リリース
  - 基本的なセットアップガイド
  - トラブルシューティング
  - セキュリティガイドライン 